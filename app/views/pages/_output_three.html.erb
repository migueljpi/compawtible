<turbo-frame id="output-three" data-controller="output" loading="lazy">
  <% if @retry %>
    <div class="modal fade <%= @prompt&.output.present? ? 'show' : 'd-none' %>" tabindex="-1" data-output-target="outputThree" role="dialog" aria-labelledby="outputThreeLabel" aria-hidden="<%= @prompt&.output.present? ? 'false' : 'true' %>">
      <div class="modal-dialog modal-dialog-centered modal-retry" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="modal-header-retry d-flex justify-content-center align-items-center position-relative">
              <h2 class="modal-title" id="outputThreeLabel">We couldn't process your request.</h2>
            </div>
            <div class="text-center modal-subheader">
              <h3>Try again with a different prompt or location!</h3>
            </div>
            <div class="text-center modal-button">
              <%= link_to "Try Again", search_path, class: "btn btn-secondary", data: { turbo: false } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <% if @best_matches.present? %>
      <div class="modal fade <%= @prompt&.output.present? ? 'show' : 'd-none' %>" tabindex="-1" data-output-target="outputThree" role="dialog" aria-labelledby="outputThreeLabel" aria-hidden="<%= @prompt&.output.present? ? 'false' : 'true' %>">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <div class="modal-header d-flex justify-content-center align-items-center position-relative">
                <h2 class="modal-title" id="outputThreeLabel">Here are your top matches!</h2>
                <!-- Custom close button -->
                <button type="button" class="position-absolute" style="top: 12px; right: 20px; background: none; border: none;" data-action="output#hideOutput" aria-label="Close">
                  <h1><i class="fa-solid fa-xmark"></i></h1>
                </button>
              </div>
              <div class="row d-flex justify-content-between pet-three-row">
                <% @best_matches.first(3).each do |pet| %>
                  <%# START CARD %>
                  <div class="col-md-4 justify-content-center pet-card-container">
                    <div class="pet-image-modal">
                      <div class="animal-images ">
                        <% if pet.photos.attached? %>
                          <%= link_to user_pet_path(pet.provider, pet), data: { turbo: false } do %>
                            <%= cl_image_tag pet.photos.first.key, class: "square-image", style: "border-radius: 15px" %>
                          <% end %>
                        <% end %>
                        <div class="animal-info">
                          <div>
                            <p><strong><%= pet.name %></strong> - <%= pet.breed %> <%= pet.species %> </p>
                          </div>
                          <div>
                            <p><%= pet.description %></p>
                          </div>
                        </div>
                        <div class="pet-card-modal-button d-flex justify-content-end">
                          <%= link_to "View Pet", user_pet_path(pet.provider, pet), class: "btn btn-primary" %>
                        </div>
                      </div>
                    </div>
                  </div>
                  <%# END CARD %>
                <% end %>
              </div>
              <div class="text-center other-matches-btn-div">
                <%= link_to "Other matches", other_matches_path(prompt_id: @prompt.id), class: "btn btn-secondary", data: { turbo: false } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="modal fade <%= @prompt&.output.present? ? 'show' : 'd-none' %>" tabindex="-1" data-output-target="outputThree" role="dialog" aria-labelledby="outputThreeLabel" aria-hidden="<%= @prompt&.output.present? ? 'false' : 'true' %>">
        <div class="modal-dialog modal-dialog-centered modal-retry" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <div class="modal-header-retry d-flex justify-content-center align-items-center position-relative">
                <h2 class="modal-title" id="outputThreeLabel">We couldn't find any matches for you.</h2>
              </div>
              <div class="text-center modal-subheader">
                <h3>Try again with a different prompt or location!</h3>
              </div>
              <div class="text-center modal-button">
                <%= link_to "Try Again", search_path, class: "btn btn-secondary", data: { turbo: false } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</turbo-frame>
